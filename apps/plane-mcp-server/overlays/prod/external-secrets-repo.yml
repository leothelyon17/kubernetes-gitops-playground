apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: repo-credentials-secret
  namespace: mcp-servers-prod
spec:
  refreshInterval: "1h"
  secretStoreRef:
    name: mcp-servers-vault-backend
    kind: SecretStore
  target:
    name: net-automation-k8s-repo-credentials  # Name of the Kubernetes Secret
    creationPolicy: Owner
    template:
      type: kubernetes.io/dockerconfigjson
      data:
        .dockerconfigjson: |
          {
            "auths": {
              "{{ .dockerserver }}": {
                "username": "{{ .dockerusername }}",
                "password": "{{ .dockerpassword }}",
                "email": "{{ .dockeremail }}",
                "auth": "{{ printf "%s:%s" .dockerusername .dockerpassword | b64enc }}"
              }
            }
          }

  data:
    - secretKey: dockerusername
      remoteRef:
        key: secret/my-github
        property: username
    - secretKey: dockerpassword
      remoteRef:
        key: secret/my-github
        property: pat
    - secretKey: dockeremail
      remoteRef:
        key: secret/my-github
        property: email
    - secretKey: dockerserver
      remoteRef:
        key: secret/my-github
        property: server
